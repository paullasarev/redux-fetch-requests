"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var fp=require("lodash/fp"),lodash=require("lodash");const FETCH_CANCEL_REQUESTS="FETCH_CANCEL_REQUESTS";function fetchCancelRequests(){return{type:FETCH_CANCEL_REQUESTS}}const hasRequest=fp.has("request"),responseTypes=["arraybuffer","blob","formData","json","text",null];function makeSuccessType(e){return`${e}_SUCCESS`}function makeErrorType(e){return`${e}_ERROR`}function makeCancelType(e){return`${e}_CANCEL`}function getResponseData(e,r){if(-1===responseTypes.indexOf(r))throw new Error(`responseType must be one of the following: ${responseTypes.map(String).join(", ")}`);return null===r?Promise.resolve(null):e[r]()}function isAbortError(e){return"AbortError"===e.name}async function fetchData(e,r,t){const{fetchInstance:o,baseUrl:s,abortController:n,onRequest:a,onSuccess:c,onError:p,onCancel:l}=t,{request:{url:u,responseType:i="json",isCancellable:E=!0,...C},meta:f}=e;try{const t=E&&n?{signal:n.signal}:void 0,p=lodash.isFunction(a)?a(C,e,r):C,l=await o(`${s}${u}`,{...t,...p});if(l.ok){l.data=await getResponseData(l,i);const t=lodash.isFunction(c)?c(l,e,r):l;return r({type:makeSuccessType(e.type),response:t,meta:f})}try{l.data=await l.json()}catch(e){}throw l}catch(t){const o=isAbortError(t),s=o?makeCancelType(e.type):makeErrorType(e.type),n=o?l:p;return lodash.isFunction(n)&&n(t,e,r),r({type:s,error:t,meta:f})}}function createMiddleware(e){const{fetchInstance:r=fetch,baseUrl:t="/",abortController:o=new AbortController,onRequest:s,onSuccess:n,onError:a,onCancel:c}=e;return({dispatch:e})=>p=>l=>l.type===FETCH_CANCEL_REQUESTS?(o.abort(),p(l)):hasRequest(l)?fetchData(l,e,{fetchInstance:r,baseUrl:t,abortController:o,onRequest:s,onSuccess:n,onError:a,onCancel:c}):p(l)}exports.FETCH_CANCEL_REQUESTS=FETCH_CANCEL_REQUESTS,exports.createMiddleware=createMiddleware,exports.fetchCancelRequests=fetchCancelRequests,exports.fetchData=fetchData,exports.getResponseData=getResponseData,exports.isAbortError=isAbortError,exports.makeCancelType=makeCancelType,exports.makeErrorType=makeErrorType,exports.makeSuccessType=makeSuccessType;
